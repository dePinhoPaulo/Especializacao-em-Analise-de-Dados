AULA_1: Introdução


AULA_2: Contextos de Avaliação

    Contexto de linha:
        Calcula o valor baseado naquela linha;
    
    Contexto de filtro:
        Calcula o valor baseado nos filtros que estão sendo aplicados;


AULA_3: Testando os conhecimentos de Contexto de filtro

    "Explicação do contaxto de Filtro"


AULA_4: Testando os conhecimentos de Contexto de filtro (Parte 2)

    "Fazendo medidas e jogando na atriz para explicar contexto de filtro"


AULA_5: Entendendo as bases e criando as colunas calculadas

    Coluna calculada:
        Faturamento na Venda = 
            BaseVendas[Tamanho Pedido]*RELATED(CadastroProdutos[Preço Unitário])
        Custo na Venda = 
            BaseVendas[Tamanho Pedido]*RELATED(CadastroProdutos[Custo Unitário])
        Margem na Venda = 
            (BaseVendas[Faturamento na Venda] - BaseVendas[Custo na Venda]) / BaseVendas[Faturamento na Venda]


AULA_6: Devo usar colunas calculadas ou medidas?

    Coluna calculada:
        Lucro na Venda = 
            BaseVendas[Faturamento na Venda] - BaseVendas[Custo na Venda]


AULA_7: Criando Medidas para corrigir os cálculos

    Margem Venda = 
        SUM(BaseVendas[Lucro na Venda]) / SUM(BaseVendas[Faturamento na Venda])
    
    "Para Calculo de porcentagem deve-se utilizar medida pois tem o contexto de Filtro"


AULA_8: Variáveis em DAX para organizar os cálculos

    medida usando Variaveis:
        Margem Venda = 
            VAR Lucro = SUM(BaseVendas[Lucro na Venda]) 
            VAR FAturamento = SUM(BaseVendas[Faturamento na Venda])

            RETURN
                Lucro/FAturamento


AULA_9: Trocando as colunas calculadas por medidas - Parte 1

    Excluindo colunas calculadas:
        Faturamento total;
        Lucro total;
    
    Medidas:
        Faturamento total = 
            SUMX(
                BaseVendas,
                BaseVendas[Tamanho Pedido] * RELATED(CadastroProdutos[Preço Unitário])
            )


10. Trocando as colunas calculadas por medidas - Parte 2

    Medidas:
        Custo total = 
            SUMX(
                BaseVendas,
                BaseVendas[Tamanho Pedido] * RELATED(CadastroProdutos[Custo Unitário])
            )
        Lucro total = 
            [Faturamento total] - [Custo total]
        Marge


AULA_11: Entendendo as funções iterativas do Power BI

    Funções Iteradoras:
        Contexto de linha - Colunas;
        Contexto de filtro - Medidas;
        
        SUMX, MAXX, AVERAGEX, ...


AULA_12: Aplicando as Funções Iterativas (Parte 1)

    Medidas:
        Media de Lucro = 
            AVERAGEX(
                'BaseDevoluções',
                [Faturamento total] - [Custo total]
            )
        Maximo de Lucro = 
            MAXX(
                'BaseDevoluções',
                [Faturamento total] - [Custo total]
            )


AULA_13: Aplicando as Funções Iterativas (Parte 2)

    Medidas:
        Lucro Total com Desconto = 
            SUMX(
                'Base Vendas',
                [Faturamento Total] *
                (1-RELATED('Cadastro Promocoes'[Percentual Desconto])) -
                [Custo Total]
            )


AULA_14: Criando Tabela Calendário com DAX - Função CALENDARAUTO

    Tabela Calendário automatica:
        Calendario = 
            CALENDARAUTO()
        "Verifica menor e menor data entre as tabelas do modelo"
        "pega o inico do ano da menor data e o fim do ano da maior"


AULA_15: Criando Tabela Calendário com DAX - Função CALENDAR

    Tabela Calendário:
        Calendario = 
            VAR Inicio = 
                DATE(YEAR(MIN('Base Vendas'[Data da Venda])),01,01)
            VAR Fim = 
                DATE(YEAR(MAX('Base Vendas'[Data da Venda])),12,31)
            RETURN
                CALENDAR(Inicio, Fim)

        "O ideal é pegar to o ano tanto de menor quanto maior data"


AULA_16: Diferença entre criar Tabelas com DAX ou no Power Query

    "Tabelas criadas em DAX, Não estão no Power Query"
    "Em DAX a tabela deixa o projeto mais leve"


AULA_17: Criando Colunas na Tabela Calendário

    Colunas:
        Ano = YEAR(Calendario[Date]);
        Mes = MONTH(Calendario[Date]);
        Mes_nome = Calendario[Date].[Mês];
        Trimestre = Calendario[Date].[QuarterNo];
        Inicio_mes = STARTOFMONTH(Calendario[Date]);
        Inicio_ano = STARTOFYEAR(Calendario[Date]);
        Inicio_trimestre = STARTOFQUARTER(Calendario[Date]);
    
    "Relacionar calendario e base de vendas"


AULA_18: Criando Tabelas Filtradas com a Função Filter (Parte 1)

    Medidas com filtro:
        Total vendas Ticket > 100 = 
            SUMX(
                FILTER(
                    'Base Vendas',
                    'Base Vendas'[Preco Unitario] > 100
                ),
                'Base Vendas'[Quantidade Vendida]
            )


AULA_19: Criando Tabelas Filtradas com a Função Filter (Parte 2)

    Medidas com filtro:
        Vendas com Fat. > 1000 = 
            COUNTX(
                FILTER(
                    'Base Vendas',
                    [Faturamento Total] > 1000
                ),
                'Base Vendas'[ID Produto]
            )
    "Filtrando tabelas virtuamente"


AULA_20: Transição de Contexto (Parte 1)

    Coluna - Cadastro Produtos:
        Total de Vendas = SUM('Base Vendas'[Quantidade Vendida]) :
            "Retorna valor total, repetindo em todas linhas, pois formula SUM esta no contexto de filtro"
        Total de Vendas = CALCULATE(SUM('Base Vendas'[Quantidade Vendida])) :
            "Adiconando o CALCULATE o resultado será correto, pois trara a formula para o contexto de linha"


AULA_21: Transição de Contexto (Parte 2)

    Coluna - Cadastro Produtos: 
        Total de Vendas = [Total Vendas] :
            "Outra forma, é trazer uma medida para o Calculo de coluna, ficara no contexto de linha"


AULA_22: Exercício - Transição de Contexto - Explicação

    Explicação


AULA_23: Exercício - Transição de Contexto - Resolução

    Coluna calculada:
        Base Vendas:
            Total Devolucoe por Produtos = 
                CALCULATE(SUM('Base Vendas'[Quantidade devolvida]))
            OU
            Total Devolucoe por Produtos = [Total Devolucoe]

        Canais de Vendas:
            Total de vendas por Canal = [Total Vendas]
    

AULA_24: Função VALUES (Parte 1)

    VALUES(): "Função filtra valores distintos"


AULA_25: Função VALUES (Parte 2)

    Medida:
        Media de Faturamento Anual = 
            AVERAGEX(
                VALUES(Calendario[Ano]),
                [Faturamento Total]
            )


AULA_26: Exercício - Função VALUES - Explicação

    EX1: Qual a media de faturamento mensal?
    EX2: Qual foi o Maximo que a empresa faturou em um unico mes?

    Media de faturamento mensal = 
        AVERAGEX(
            VALUES(Calendario[Inicio_mes]),
            [Faturamento Total]
        )
    Maximo de faturamento num mes = 
        MAXX(
            VALUES(Calendario[Inicio_mes]),
            [Faturamento Total]
        )
    

27. Exercício - Função VALUES - Resolução (Parte 1)

    EX: OK


AULA_28: Exercício - Função VALUES - Resolução (Parte 2)

    EX: OK


AULA_29: Funções VALUES e FILTER (Parte 1)

    Meses que faturou mais que 200 Milhões:
        Nova Tabela:
            Meses Fat. < 200 Mi = 
                FILTER(
                    VALUES(Calendario[Inicio_mes]),
                    [Faturamento Total] > 200000000
                )
        Coluna:
            Faturamento = [Faturamento Total]
        
        "Relacinar com Calendario"

        Medida:
            % Meses acima da meta = 
                COUNT('Meses Fat. < 200 Mi'[Inicio_mes]) / 
                DISTINCTCOUNT(Calendario[Inicio_mes])


AULA_30: Funções VALUES e FILTER (Parte 2)

    Crindao calculo anterior em medida:
        Qtd Meses acima da meta = 
            COUNTROWS(
                FILTER(
                    VALUES(Calendario[Inicio_mes]),
                    [Faturamento Total] > 200000000
                )
            )
        
        Qtd Total Meses = 
            DISTINCTCOUNT(Calendario[Inicio_mes])
        
        % Meses acima da meta 2 = 
            [Qtd Meses acima da meta] / [Qtd Total Meses]


AULA_31: Dica - Criando Medidas mais Eficientes

    Resumindo medida em uma só:
        % Meses acima da meta = 
            VAR Meses_acima_meta = 
                COUNTROWS(
                    FILTER(
                        VALUES(Calendario[Inicio_mes]),
                        [Faturamento Total] > 200000000
                    )
                )
            
            VAR Total_Meses = 
                    DISTINCTCOUNT(Calendario[Inicio_mes])
            
            RETURN
                Meses_acima_meta / Total_Meses


AULA_32: Funções VALUES e FILTER (Parte 3)

    Meta que cada marca tenha no maximo 1,15% de devoluções:
        Nova tabela:
            Marcas = 
                Values('Cadastro Produtos'[Nome da Marca])
        
        "Relacionar tabelas"
        
        Medida:
            % Devolucoes = 
                [Total Devolucoes]/[Total Vendas]  

        Coluna:
            % Devolucao por marca = 
                % Devolucao


AULA_33: Funções VALUES e FILTER (Parte 4)

    Marcas = 
        FILTER(
            VALUES('Cadastro Produtos'[Nome da Marca]),
            [% Devolucoes] <= 0.0115
        )
        
    medida:
        COUNTROWS(Marcas)/DISTINCTCOUNT('Cadastro Produtos'[Nome da Marca])
    

AULA_34: Funções VALUES e FILTER (Parte 5)

    % Marcar dentro da meta de Dev. = 
        VAR Marcas_Detro_Meta = 
            COUNTROWS(
                FILTER(
                    VALUES('Cadastro Produtos'[Nome da Marca]),
                    [% Devolucoes] <= 0.0115
                )
            )
        
        VAR Total_Marcas = 
            DISTINCTCOUNT('Cadastro Produtos'[Nome da Marca])
        
        RETURN
            Marcas_Detro_Meta / Total_Marcas


AULA_35: Função CROSSJOIN

    Qual a media de Faturamento de uma Loja em um mês:
        Nova tabela:
            Meses e Lojas = 
                CROSSJOIN(
                    VALUES('Cadastro Lojas'[Nome da Loja]),
                    VALUES(Calendario[Inicio_mes])
                )
                "Adicionou uma loja para mes"
            
        Nova medida:
            Media de Faturamento de Loja por Mes = 
                AVERAGEX(
                    CROSSJOIN(
                        VALUES('Cadastro Lojas'[Nome da Loja]),
                        VALUES(Calendario[Inicio_mes])
                    ),
                    [Faturamento Total]
                )


AULA_36: Exercício - Função CROSSJOIN

    Qual o maximo que um cliente ja gastou com a gente em um ano:
        Medida:
            Maior faturamento de cliente em um ano = 
                MAXX(
                    CROSSJOIN(
                        VALUES('Cadastro Clientes'[ID Cliente]),
                        VALUES(Calendario[Ano])
                    ),
                    [Faturamento Total]
                )


AULA_37: Funções CALCULATE E ALL

    Remove filtros de marcas e traz valor absoluto:
        Total vendas fixo = 
            CALCULATE(
                [Total Vendas],
                ALL('Cadastro Produtos')
            )
        
        % de vendas = 
            [Total Vendas]/[Total vendas fixo]


AULA_38: Funções CALCULATE E ALL - Dicas e cuidados

    Remove filtros independente da tabela e traz valor absoluto:
        Total vendas fixo = 
            CALCULATE(
                [Total Vendas],
                ALL('Base Vendas')
            )


AULA_39: Funções CALCULATE E ALLSELECTED

    Adicionando Filtro de ano:
        Segmantação de dados;
        Calendario - Ano.
    
    Total vendas com segmentação = 
        CALCULATE(
            [Total Vendas],
            ALLSELECTED('Base Vendas')
        )


AULA_40: Organizando as Medidas com Variáveis

    Organizando medidas:
        % de Vendas = 
            VAR Total_vendas_segmentacao =
                CALCULATE(
                    [Total Vendas],
                    ALLSELECTED('Base Vendas')
                )

            RETURN
                [Total Vendas]/Total_vendas_segmentacao


AULA_41: CALCULATE com várias condições (E)

    Qual foi o Fat. da marca contoso em 2018:
        Total Fat. Contoso 2018 = 
            CALCULATE(
                [Faturamento Total],
                'Cadastro Produtos'[Nome da Marca] = "Contoso",
                Calendario[Ano] = 2018
            )
        
        "Utilizar CALCULATE para calculos com filtros especificos"
        
        Total Vendas Audio Onlie = 
            CALCULATE(
                [Total Vendas],
                'Cadastro Subcategorias'[Categoria do Produto] = "Áudio",
                'Cadastro Canais de Venda'[Nome do Canal] = "Online"
            )


AULA_42: CALCULATE com várias condições (OU) - Parte 1

    Qual foi o Fat. da marca contoso ou Litware:
        Qual foi o Fat. da marca contoso + Litware = 
            CALCULATE(
                [Faturamento Total],
                'Cadastro Produtos'[Nome da Marca] = "Contoso" ||
                'Cadastro Produtos'[Nome da Marca] = "Litware"
            )
        Outra Forma:
        Qual foi o Fat. da marca contoso + Litware = 
            CALCULATE(
                [Faturamento Total],
                'Cadastro Produtos'[Nome da Marca] IN {"Contoso", "Litware"}
            )

    Qual Total de devoluções de audio + computador no ano de 2018:
        Total de Devolução audio+computador 2018 = 
            CALCULATE(
                [Total Devolucoes],
                'Cadastro Subcategorias'[Categoria do Produto] IN {"Áudio", "Computador"},
                Calendario[Ano] = 2018
            )


AULA_43: CALCULATE com várias condições (OU) - Parte 2

    Qual foi total de de produtos de Luxo + vendas da marca contoso:
        Total de vendas Luxo + marca contoso = 
            CALCULATE(
                [Total Vendas],
                'Cadastro Produtos'[Tipo] = "Luxo" ||
                'Cadastro Produtos'[Nome da Marca] = "Contoso"
            )


AULA_44: CALCULATE e CONTAINSSTRING - Filtrando se contém um texto específico

    Total de vendas que a promoção de vendas geraram:
        Medida:
            Total vendas promoção ferias = 
                CALCULATE(
                    [Total Vendas],
                    FILTER(
                        'Cadastro Promocoes',
                        CONTAINSSTRING('Cadastro Promocoes'[Nome Promocao],"Férias")
                    )
                )

    Total de vendas de Produtos Bluetooth:
        Total vendas bluetooth = 
            CALCULATE(
                [Total Vendas],
                FILTER(
                    'Cadastro Produtos',
                    CONTAINSSTRING('Cadastro Produtos'[Nome do Produto],"Bluetooth")
                )
            )


AULA_45: Cálculo do Acumulado ao longo do tempo

    faturamento Acumulado:
        Faturamento Acumulado = 
            CALCULATE(
                [Faturamento Total],
                FILTER(
                    ALL(Calendario),
                    Calendario[Date]<=MAX(Calendario[Date])
                )    
            )


AULA_46: Dica - Formatação Personalizada de Data com a Função FORMAT

    Dta personalizada:
        Trimestre - Ano = 
            FORMAT(
                Calendario[Date],
                "Q-YYYY"
            )
        "Ordenar por Iniciotrimestre"


AULA_47: Exercício - Cálculo do Acumulado ao longo do tempo
    
    Acumulado Vendas = 
        CALCULATE(
            [Total Vendas],
            FILTER(
                ALL(Calendario),
                Calendario[Date]<=MAX(Calendario[Date])
            )       
        )


AULA_48: Inteligência de Tempo - Funções TOTALYTD, TOTALQTD, TOTALMTD

    FATURAMENTO ACUMULADO ANO A ANO, (Trimestre E MES):
        Faturamento YTD = 
            TOTALYTD(
                [Faturamento Total],
                Calendario[Date]
            )
    
        Faturamento QTD = 
            TOTALQTD(
                [Faturamento Total],
                Calendario[Date]
            )
        
        Faturamento MTD = 
            TOTALMTD(
                [Faturamento Total],
                Calendario[Date]
            )


AULA_49: Crescimento YoY

    Faturamento do periodo no ano anterior:
        Faturamento YTD Ano anterior = 
            Faturamento YTD Ano anterior = 
                CALCULATE(
                    [Faturamento YTD],
                    PARALLELPERIOD(
                        Calendario[Date],
                        -12,
                        MONTH
                    )
                )
        
    Crescimento ano sobre ano:
        Faturamento YTD YOY = 
            DIVIDE(
                [Faturamento YTD]-[Faturamento YTD Ano anterior],
                [Faturamento YTD Ano anterior],
                "Sem historico"
            )